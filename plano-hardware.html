<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechEdu - Plano de Hardware</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <a href="index.html" class="logo">TechEdu</a>
        <div class="user-profile">
            <a href="#">üë§</a>
        </div>
    </header>

    <main>
        <a href="index.html" class="back-link">&larr; Voltar para planos</a>

        <section class="plan-header">
            <img src="https://i.imgur.com/8QpA0gR.png" alt="Placa de Hardware">
            <div class="header-text">
                <h1>Informa√ß√µes do seu plano de Hardware:</h1>
                <p>√ìtima escolha! Agora personalize as informa√ß√µes do seu plano.</p>
            </div>
        </section>

        <section class="plan-form">
            <form action="#" method="POST">
                
                <div class="form-group">
                    <label for="plan-name">Nome do plano</label>
                    <input type="text" id="plan-name" name="plan_name" value="Trilha de Aprendizado em Hardware">
                </div>

                <div class="form-group">
                    <label for="knowledge-level">Meu N√≠vel de Conhecimento</label>
                    <select id="knowledge-level" name="knowledge_level">
                        <option value="iniciante">Iniciante (Come√ßando do zero)</option>
                        <option value="intermediario">Intermedi√°rio (J√° tenho algum conhecimento)</option>
                        <option value="avancado">Avan√ßado (J√° sou um especialista)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="main-goal">Meu Objetivo Principal</label>
                    <select id="main-goal" name="main_goal">
                        <option value="montar">Montar meu primeiro PC</option>
                        <option value="manutencao">Fazer manuten√ß√£o b√°sica</option>
                        <option value="componentes">Entender o funcionamento dos componentes</option>
                        <option value="tecnico">Tornar-me um t√©cnico de hardware</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="plan-description">Descri√ß√£o</label>
                    <textarea id="plan-description" name="plan_description" placeholder="Escreva um breve resumo do que voc√™ espera deste plano...">Eu preciso de um plano de estudos de hardware. Quero algo simples, que me ajude a entender os conceitos b√°sicos e a montar um computador.</textarea>
                </div>

                <div class="form-group">
                    <label>T√≥picos de Foco</label>
                    <div class="topics-group">
                        <div class="topic-item">
                            <input type="checkbox" id="topic1" name="topic" value="cpu" checked>
                            <label for="topic1">Processadores (CPUs)</label>
                        </div>
                        <div class="topic-item">
                            <input type="checkbox" id="topic2" name="topic" value="motherboard" checked>
                            <label for="topic2">Placas-M√£e</label>
                        </div>
                        <div class="topic-item">
                            <input type="checkbox" id="topic3" name="topic" value="ram">
                            <label for="topic3">Mem√≥ria RAM</label>
                        </div>
                        <div class="topic-item">
                            <input type="checkbox" id="topic4" name="topic" value="gpu">
                            <label for="topic4">Placas de V√≠deo (GPUs)</label>
                        </div>
                        <div class="topic-item">
                            <input type="checkbox" id="topic5" name="topic" value="storage" checked>
                            <label for="topic5">Armazenamento (SSD/HDD)</label>
                        </div>
                        <div class="topic-item">
                            <input type="checkbox" id="topic6" name="topic" value="psu">
                            <label for="topic6">Fontes de Alimenta√ß√£o (PSUs)</label>
                        </div>
                    </div>
                </div>

                <div class="form-group-toggle">
                    <span>Tornar este plano p√∫blico?</span>
                    <label class="switch">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <button type="submit" class="submit-button">Gerar meu Plano de Estudos</button>
            </form>
            
            </section>
    </main>

    <script>
        const planForm = document.querySelector('.plan-form form');
        const submitButton = document.querySelector('.submit-button');

        planForm.addEventListener('submit', async function(event) {
            event.preventDefault(); 
            const formData = new FormData(planForm);
            
            const data = {
                topics: [] // Garante que 'topics' seja sempre uma lista
            };
            formData.forEach((value, key) => {
                if (key === 'topic') {
                    data.topics.push(value);
                } else {
                    data[key] = value;
                }
            });

            submitButton.textContent = 'Gerando seu plano...';
            submitButton.disabled = true;

            try {
                // 1. Simula a chamada da API
                const simulatedResponse = await generateSimulatedPlan(data);
                
                // 2. Remove o plano antigo, se existir
                const oldResult = document.querySelector('.plan-result');
                if(oldResult) oldResult.remove();

                // 3. Cria a nova div e insere o HTML gerado
                const resultDiv = document.createElement('div');
                resultDiv.className = 'plan-result';
                resultDiv.innerHTML = simulatedResponse;
                planForm.after(resultDiv);

                // 4. ATIVA a barra de progresso
                activateProgressBar();

                submitButton.textContent = 'Plano Gerado com Sucesso!';

            } catch (error) {
                console.error("Erro na gera√ß√£o: ", error);
                submitButton.textContent = 'Erro ao gerar. Tente novamente.';
            } finally {
                submitButton.disabled = false;
            }
        });

        /**
         * Adiciona os "escutadores" de evento aos checkboxes
         * para atualizar a barra de progresso.
         */
        function activateProgressBar() {
            const allTasks = document.querySelectorAll('.task-checkbox');
            const progressBarFill = document.querySelector('.progress-bar-fill');
            const progressText = document.querySelector('.progress-text');
            const totalTasks = allTasks.length;

            if (totalTasks === 0) return; // N√£o faz nada se n√£o houver tarefas

            // Fun√ß√£o para calcular e atualizar a barra
            function updateProgress() {
                const checkedTasks = document.querySelectorAll('.task-checkbox:checked').length;
                const percentage = (checkedTasks / totalTasks) * 100;
                
                progressBarFill.style.width = `${percentage}%`;
                progressText.textContent = `Progresso: ${Math.round(percentage)}% (${checkedTasks} de ${totalTasks} tarefas)`;
            }

            // Adiciona o "escutador" a cada checkbox
            allTasks.forEach(task => {
                task.addEventListener('change', updateProgress);
            });

            // Atualiza a barra pela primeira vez (para mostrar 0%)
            updateProgress();
        }

        /**
         * FUN√á√ÉO DE SIMULA√á√ÉO (API de IA)
         * Gera o novo HTML com m√≥dulos e checkboxes.
         */
        async function generateSimulatedPlan(data) {
            console.log("Dados enviados para a IA:", data);
            await new Promise(resolve => setTimeout(resolve, 1500)); 

            let planHtml = `
                <h2>Seu Plano de Hardware (N√≠vel: ${data.knowledge_level})</h2>
                <p><strong>Objetivo:</strong> ${data.main_goal}</p>

                <div class="progress-section">
                    <div class="progress-text">Progresso: 0% (0 de X tarefas)</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill"></div>
                    </div>
                </div>

                <div class="plan-modules">
            `;

            // M√≥dulo 1: Fixo
            planHtml += `
                <div class="module">
                    <div class="module-header">M√≥dulo 1: Conceitos Fundamentais</div>
                    <ul class="task-list">
                        <li class="task-item">
                            <input type="checkbox" id="task1-1" class="task-checkbox">
                            <label for="task1-1">O que √© Hardware e Software?</label>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" id="task1-2" class="task-checkbox">
                            <label for="task1-2">Tipos de Gabinetes e Fun√ß√µes</label>
                        </li>
                    </ul>
                </div>
            `;

            // M√≥dulos Condicionais (baseados nos checkboxes)
            if (data.topics.includes('cpu')) {
                planHtml += `
                <div class="module">
                    <div class="module-header">M√≥dulo 2: Processadores (CPU)</div>
                    <ul class="task-list">
                        <li class="task-item">
                            <input type="checkbox" id="task-cpu-1" class="task-checkbox">
                            <label for="task-cpu-1">Intel vs AMD: Pr√≥s e Contras</label>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" id="task-cpu-2" class="task-checkbox">
                            <label for="task-cpu-2">Instala√ß√£o e Pasta T√©rmica</label>
                        </li>
                    </ul>
                </div>
                `;
            }

            if (data.topics.includes('motherboard')) {
                planHtml += `
                <div class="module">
                    <div class="module-header">M√≥dulo 3: Placa-M√£e</div>
                    <ul class="task-list">
                        <li class="task-item">
                            <input type="checkbox" id="task-mobo-1" class="task-checkbox">
                            <label for="task-mobo-1">Formatos (ATX, Micro-ATX, ITX)</label>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" id="task-mobo-2" class="task-checkbox">
                            <label for="task-mobo-2">Conectores do Painel Frontal</label>
                        </li>
                    </ul>
                </div>
                `;
            }
            
            // M√≥dulo Final: Fixo
            planHtml += `
                <div class="module">
                    <div class="module-header">M√≥dulo Final: Montagem</div>
                    <ul class="task-list">
                        <li class="task-item">
                            <input type="checkbox" id="task-final-1" class="task-checkbox">
                            <label for="task-final-1">Montagem passo a passo do PC</label>
                        </li>
                        <li class="task-item">
                            <input type="checkbox" id="task-final-2" class="task-checkbox">
                            <label for="task-final-2">Primeiro Boot e Configura√ß√£o da BIOS</label>
                        </li>
                    </ul>
                </div>
            `;

            planHtml += `</div>`; // Fecha .plan-modules
            return planHtml;
        }
    </script>
</body>
</html>